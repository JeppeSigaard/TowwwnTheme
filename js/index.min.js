var HelpFunctions={numOfIncludes:function(e,t){for(var i=0,n=0;n!==-1;)n=e.indexOf(t,n),n!==-1&&(i++,n++);return i},nl2p:function(e){return e.length>0?"<p>"+e.replace(/[\r\n]+/g,"</p><p>")+"</p>":null},linkifier:function(e){var t=/(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim,i=e.replace(t,'<a href="$1" target="_blank">$1</a>'),n=/(^|[^\/])(www\.[\S]+(\b|$))/gim,i=i.replace(n,'$1<a href="http://$2" target="_blank">$2</a>'),s=/(\w+@[a-zA-Z_]+?\.[a-zA-Z]{2,6})/gim,i=i.replace(s,'<a href="mailto:$1">$1</a>');return i},formatDate:function(e,t,i){var n=new Date(e.substr(0,16)),s="";if(i){var o=["Søndag","Mandag","Tirsdag","Onsdag","Torsdag","Fredag","Lørdag"];s+=o[n.getDay()]+" d. "}return s+=parseInt(n.getDate())+" / "+parseInt(n.getMonth()+1)+" - "+parseInt(n.getFullYear()),t&&(s+=n.getMinutes()<10?" kl. "+(n.getHours()-1)+":0"+n.getMinutes():" kl. "+(n.getHours()-1)+":"+n.getMinutes()),s}};jQuery.prototype.monthPicker=function(e,t){var i="monthPicker_selector";if(e.remove===!0)return $("."+i).removeClass("active"),$(this).removeClass("pickerActive"),void setTimeout(function(){$("."+i).remove()},150);var n=null;"undefined"!=typeof e.appendSelector&&null!==e.appendSelector&&(n=e.appendSelector);var s=null;"undefined"!=typeof e.years&&null!==e.years&&(s=e.years);for(var o={0:"Jan",1:"Feb",2:"Mar",3:"Apr",4:"Maj",5:"Jun",6:"Jul",7:"Aug",8:"Sep",9:"Okt",10:"Nov",11:"Dec"},s=[],a=2010;a<=2020;a++)s.push(a.toString());var r=$(this),l='<div class="'+i+'">',c=[],d=null;for(var g in s)for(var h in o)l+='<div class="month" data-key="'+h+'" id="'+s[g]+"-"+h+'"><div class="monthTitle">'+o[h]+"</div>",l+='<div class="yearTitle" data-key="'+s[g]+'">'+s[g]+"</div></div>";l+="</div>",r.html('Alle <div class="pickerArrow"></div>'),r.click(function(){if(setTimeout(function(){syncScroll.rescaleContainer()},200),$(this).hasClass("pickerActive"))$("."+i).removeClass("active"),$(this).removeClass("pickerActive"),setTimeout(function(){$("."+i).remove()},150);else{if(null!==n?$(n).append(l):$("body").append(l),$(this).addClass("pickerActive"),$("."+i).flickity({cellAlign:"center",prevNextButtons:!1,pageDots:!1}),$("."+i).addClass("active"),1===c.length)$("."+i+" #"+c[0]).addClass("active");else if(c.length>1){$("."+i+" #"+c[0]).addClass("active-left"),$("."+i+" #"+c[c.length-1]).addClass("active-right");for(var e=1;e<c.length-1;e++)$("."+i+" #"+c[e]).addClass("active-middle")}var a=new Date,g=(new Date).getFullYear().toString(),h=(new Date).getMonth().toString(),u;for(u=0;u<s.length;u++)if(s[u]===g){u*=12;break}for(var v in o)o.key===h&&(u+=parseInt(v));console.log(u),$("."+i).flickity("select",u),$("."+i+" .month").click(function(){$("."+i+" .month").removeClass("active"),$("."+i+" .month").removeClass("active-left"),$("."+i+" .month").removeClass("active-middle"),$("."+i+" .month").removeClass("active-right"),c=[];var e=parseInt($(this).attr("data-key")),n=parseInt($(".yearTitle",this).attr("data-key")),s=new Date(n,e).getTime(),a=new Date(n,e+1).getTime();if(null!==d){if($(this).attr("data-key")===d.attr("data-key"))return d.removeClass("active"),r[0].month_from=(new Date).getTime(),r[0].month_to=new Date(3e3,1).getTime(),d=null,r.html('Alle <div class="pickerArrow"></div>'),void t(r);var l=parseInt(d.attr("data-key")),g=parseInt($(".yearTitle",d).attr("data-key")),h=0,u=0,v=0,m=0;new Date(g,l).getTime()<new Date(n,e).getTime()?(s=new Date(g,l).getTime(),h=l,v=g,a=new Date(n,e+1).getTime(),u=e,m=n,d.addClass("active-left"),$(this).addClass("active-right")):(s=new Date(n,e).getTime(),h=e,v=n,a=new Date(g,l+1).getTime(),u=l,m=g,$(this).addClass("active-left"),d.addClass("active-right")),r.html(o[h]+" "+String(v).substr(2,3)+" - "+o[u]+" "+String(m).substr(2,3)+'<div class="pickerArrow"></div>'),d=null}else d=$(this),$(this).addClass("active"),r.html(o[$(this).attr("data-key")]+" "+$(".yearTitle",this).attr("data-key")+'<div class="pickerArrow"></div>'),c.push($(".yearTitle",this).attr("data-key")+"-"+$(this).attr("data-key"));for(var f=v;f<m+1;f++)for(var p=h;p<u+1;p++)c.push(f+"-"+p);if("undefined"!==v&&"undefined"!==m)if(parseInt(v)!==parseInt(m)){for(var w=h+1;w<12;w++)$("#"+v+"-"+w).addClass("active-middle");for(var w=0;w<u;w++)$("#"+m+"-"+w).addClass("active-middle");for(var b=v+1;b<m;b++)for(var w=0;w<12;w++)$("#"+b+"-"+w).addClass("active-middle")}else for(var w=h+1;w<u;w++)$("#"+v+"-"+w).addClass("active-middle");r[0].month_from=s,r[0].month_to=a,t(r)})}}.bind(r,i))};var syncScroll={settings:{canFixedScroll:!0,container:null,elem:null,inner:null,containerHeight:0,highestElem:null,lastScrollTop:0},init:function(e,t,i){syncScroll.wrapElems(e,t,function(){syncScroll.rescaleContainer(),syncScroll.bindUIActions(e,t,i)})},bindUIActions:function(e,t,i){syncScroll.onScroll(),$(window).on("scroll",function(){syncScroll.settings.canFixedScroll&&syncScroll.onScroll()}),$(window).on("resize",function(){syncScroll.rescaleContainer(),syncScroll.setHorizontalPosition()})},wrapElems:function(e,t,i){syncScroll.settings.container=e,syncScroll.settings.elem=$(".sync-outer"),syncScroll.settings.inner=$(".sync-outer .sync-inner"),"function"==typeof i&&i()},setHorizontalPosition:function(){syncScroll.settings.elem.each(function(){$(this).hasClass("fixed")?$(this).css({left:$(this).parent().offset().left,width:$(this).parent().width()}):$(this).removeAttr("style")})},rescaleContainer:function(){$(".sync-outer.high").removeClass("high"),syncScroll.settings.containerHeight=0;var e=null;syncScroll.settings.inner.each(function(){$(this).innerHeight()>syncScroll.settings.containerHeight&&(syncScroll.settings.containerHeight=$(this).innerHeight(),e=$(this))}),syncScroll.settings.container.css("height",syncScroll.settings.containerHeight),e.parent(".sync-outer").addClass("high")},topAlign:function(e){if(e.find(".sync-inner").innerHeight()>=syncScroll.settings.containerHeight)$(window).scrollTop(syncScroll.settings.container.offset().top);else if(syncScroll.settings.canFixedScroll){syncScroll.settings.canFixedScroll=!1;var t=$(window).scrollTop(),i=syncScroll.settings.containerHeight,n=e.find(".inner").innerHeight(),s=Math.floor(i-(t+n));s<0&&(syncScroll.settings.elem.addClass("fixed").removeClass("bottom"),syncScroll.setHorizontalPosition(),$(window).scrollTop(t+s)),e.find(".sync-outer").scrollTop("0"),syncScroll.settings.lastScrollTop=t,syncScroll.settings.canFixedScroll=!0}},onScroll:function(){var e=syncScroll.settings.container,t=$(window).scrollTop(),i=t-syncScroll.settings.lastScrollTop;syncScroll.settings.container.offset().top>=$(window).scrollTop()+60?syncScroll.settings.elem.each(function(){$(this).hasClass("high")||$(this).addClass("top").removeClass("bottom fixed").removeAttr("style")}):e.offset().top+e.innerHeight()<=$(window).scrollTop()+$(window).innerHeight()?syncScroll.settings.elem.each(function(){$(this).hasClass("high")||$(this).addClass("bottom").removeClass("top fixed").removeAttr("style")}):(syncScroll.settings.elem.each(function(){var e=$(this).scrollTop()+i;$(this).hasClass("high")||($(this).hasClass("bottom")?($(this).addClass("fixed").removeClass("bottom"),$(this).scrollTop(5e16)):$(this).hasClass("top")?($(this).addClass("fixed").removeClass("top"),$(this).scrollTop("0")):($(this).addClass("fixed"),$(this).scrollTop(e)))}),syncScroll.setHorizontalPosition()),syncScroll.settings.lastScrollTop=t}},SearchModule={settings:{keyword:"",getnum:15,left_container:$(".left-container .content"),right_container:$(".right-container .content")},init:function(){this.bindUIActions()},bindUIActions:function(){$("#searchfield").on("focus",function(){$("#searchlabel").addClass("not-visible")}),$("#searchfield").on("focusout",function(){""==$(this).val()&&$("#searchlabel").removeClass("not-visible")}),$("#searchfield").on("keyup",function(e){this.settings.keyword=$("#searchfield").val().toLowerCase(),13===e.keyCode&&""!==this.settings.keyword&&this.search()}.bind(this))},search:function(){for(var e=[],t=EventContentModule.settings.events,i=0;i<t.length;i++){for(var n=0,s=0,o=0,a=0,r=this.settings.keyword.split(" "),l=0;l<r.length;l++)r[l].length>1&&(s+=2*HelpFunctions.numOfIncludes(t[i].name.toLowerCase(),r[l]),a+=4*HelpFunctions.numOfIncludes(t[i].parentname.toLowerCase(),r[l]),null!==t[i].description&&(o+=HelpFunctions.numOfIncludes(t[i].description.toLowerCase(),r[l])/2));n=s+o+a,(n>=4||s>0)&&e.push([n,t[i]])}e.sort(function(e,t){return e[0]<t[0]?1:e[0]>t[0]?-1:0});for(var t=[],i=0;i<e.length;i++)t.push(e[i][1]);EventCalenderModule.renderEventCalender(".eventscontainer",{acceptOld:!0,getNum:0,content:t}),$(".load-more").trigger("click"),ViewHandler.closeSingleView(),$(window).trigger("resize"),setTimeout(function(){syncScroll.rescaleContainer()},50)}},ViewHandler={settings:{ready:!1,poly_view:!1,content_container:$(".content-container"),left_container:$(".left-container .content"),right_container:$(".right-container .content")},init:function(){var e,t=0,i=!1;$(document).on("click",".event",function(){ViewHandler.settings.right_container.addClass("spoopy"),EventSingleModule.render_sv_event($(this).attr("id")),EventSingleModule.bindUIActions(),setTimeout(function(){syncScroll.rescaleContainer(),syncScroll.setHorizontalPosition(),ViewHandler.settings.right_container.removeClass("spoopy"),$(window).trigger("scroll")},250),ViewHandler.toggle_poly_view(!0)}),this.settings.ready=!0},bindUIActions:function(){},toggle_poly_view:function(e){return 1==e?(this.settings.content_container.hasClass("poly-view")||$(".monthSelector").monthPicker({remove:!0}),void this.settings.content_container.addClass("poly-view")):0==e?(this.settings.content_container.hasClass("poly-view")&&$(".monthSelector").monthPicker({remove:!0}),void this.settings.content_container.removeClass("poly-view")):(this.settings.content_container.hasClass("poly-view")?this.settings.content_container.removeClass("poly-view"):this.settings.content_container.addClass("poly-view"),void $(".monthSelector").monthPicker({remove:!0}))},go_to:function(e){},reload_view:function(e){},closeSingleView:function(){this.settings.right_container.html(""),this.toggle_poly_view(!1),null!==syncScroll.settings.inner&&setTimeout(function(){syncScroll.rescaleContainer(),$(window).trigger("resize")},300)}},EventContentModule={settings:{cb:function(){},ready:!1,get_url:rest_api+"events?per_page=100&page=",page_counter:1,default_appendSelector:".eventscontainer",events:[]},init:function(e){this.settings.cb=e,this.get_events()},get_events:function(){var e=new XMLHttpRequest;e.onload=function(e){for(var t=$.parseJSON(e.target.response),i=0;i<t.length;i++)this.settings.events.push(t[i]);return t.length<1?(this.render_ready=!0,this.settings.page_counter=0,this.settings.events.sort(function(e,t){return e.start_time<t.start_time?-1:e.start_time>t.start_time?1:0}),void this.settings.cb()):(this.settings.page_counter++,void this.get_events())}.bind(this),e.open("GET",this.settings.get_url+this.settings.page_counter.toString()),e.send()}},LocationCategoryModule={settings:{ready:!1,unsorted_location_categories:{},sorted_location_categories:[]},init:function(){this.get_location_categories()},get_location_categories:function(){for(var e=LocationModule.settings.locations,t=0;t<e.length;t++)for(var i=0;i<e[t].categories.length;i++){var n=e[t].categories[i];"undefined"==typeof this.settings.unsorted_location_categories[n.category_name]?this.settings.unsorted_location_categories[n.category_name]={category_counter:1,category_name:n.category_name,category_imgurl:n.category_imgurl}:this.settings.unsorted_location_categories[n.category_name].category_counter++}var s=[];for(var o in this.settings.unsorted_location_categories){for(var a=!1,t=0;t<s.length;t++)if(this.settings.unsorted_location_categories[o].category_counter>s[t].category_counter){s.splice(t,0,this.settings.unsorted_location_categories[o]),a=!0;break}a||s.push(this.settings.unsorted_location_categories[o])}this.settings.sorted_location_categories=s,this.settings.ready=!0},render_location_categories:function(e){for(var t='<div class="category-container">',i=0;i<this.settings.sorted_location_categories.length;i++)t+=this.generate_category_html(this.settings.sorted_location_categories[i]);$(e).append(t+="</div>")},generate_category_html:function(e){var t='<div class="category" style="background-image:url('+e.category_imgurl+')">';return t+='<div class="category-content-container">',t+='<div class="category-title">'+e.category_name+"</div>",t+='<div class="category-count">'+e.category_counter+"</div></div></div>"}},LocationModule={settings:{ready:!1,page_counter:1,locations:[],callback:null},init:function(e){this.settings.callback=e,this.get_locations()},get_locations:function(){var e=new XMLHttpRequest;e.onload=function(e){for(var t=$.parseJSON(e.target.response),i=0;i<t.length;i++)this.settings.locations.push(t[i]);t.length<1?(this.settings.page_counter=0,this.settings.ready=!0):(this.settings.page_counter++,this.get_locations())}.bind(this),e.open("GET",rest_api+"locations?per_page=100&page="+this.settings.page_counter),e.send()},render_locations:function(){},generate_location_html:function(){}},EventCalenderModule={settings:{html:"",breakpointHtml:"",breakpoint:-1,breakpointArray:[],breakpointFrom:-1,breakpointTo:-1,breakpointView:""},init:function(){this.bindUIActions()},bindUIActions:function(){$(window).on("resize",function(){var e=-1,t=0,i=!0;$(".event").each(function(n,s){if(e===-1)e=s.offsetTop,t++;else{if(e!==s.offsetTop)return void(i=!1);t++}});var n=$(".eventscontainer").children(),s=n.length%t;if(n.css("max-width","none").removeClass("last-row"),i===!1)for(var o=0;o<s;o++)$("#"+n[n.length-(o+1)].attributes.id.value).css("max-width",$("#"+n[0].attributes.id.value).outerWidth()+"px").addClass("last-row");else $(".eventscontainer").hasClass("lineLayout")||n.css("max-width","195px").addClass("last-row")})},renderEventCalender:function(e,t){this.settings.breakpointView=e;var i=!1,n=25,s=-1,o=-1,a=!1,r=!0;if("undefined"!=typeof t.acceptOld&&(i=t.acceptOld),"undefined"!=typeof t.getNum&&(n=t.getNum),"undefined"!=typeof t.from&&(s=t.from),"undefined"!=typeof t.to&&(o=t.to),"undefined"!=typeof t.content&&(a=t.content,r=!1),a)this.settings.breakpointArray=t.content,this.settings.breakpoint=n,a=a.slice(0,n);else{var a=[],l=EventContentModule.settings.events,c;for(c=0;c<l.length;c++){if(a.length>n){this.settings.breakpoint=c;break}var d=new Date(l[c].start_time.substr(0,16)).getTime();!i&&d<(new Date).getTime()||s!==-1&&s>d||o!==-1&&o<d||a.push(l[c])}this.settings.breakpointArray=l}this.settings.breakpointFrom=s,this.settings.breakpointTo=o;for(var c=0;c<a.length;c++)this.settings.html+=this.generateEventHtml(a[c]);this.settings.breakpointHtml=this.settings.html,$(e).html(this.settings.html),this.settings.html=""},loadMore:function(e){for(var t=[],i=this.settings.breakpointArray,n=this.settings.breakpoint;n<i.length;n++){var s=new Date(i[n].start_time.substr(0,16)).getTime();if(t.length>=e){this.settings.breakpoint=n;break}this.settings.breakpointFrom!==-1&&this.settings.breakpointFrom>s||this.settings.breakpointTo!==-1&&this.settings.breakpointTo<s||t.push(i[n])}if(t.length<e&&(this.settings.breakpoint=i.length),0===t.length)return-1;this.settings.breakpointHtml="";for(var n=0;n<t.length;n++)this.settings.breakpointHtml+=this.generateEventHtml(t[n]);return $(this.settings.breakpointView).append(this.settings.breakpointHtml),setTimeout(function(){$(window).trigger("resize")},150),i.length-this.settings.breakpoint},generateEventHtml:function(e){var t="",i=HelpFunctions.formatDate(e.start_time,!1,!1),n=String(e.name).substr(0,36)+String(e.name).substr(36,99).split(" ")[0];n.length!==String(e.name).length&&(n+=" ...");for(var s=n.split(" "),o=0;o<s.length;o++)s[o].length>14&&(s[o]=s[o].substr(0,14)+"-<br />"+s[o].substr(12,999999999));n=s.join(" ");var t='<div class="event" id="'+e.id+'">';return t+=""!==e.imgurl&&null!==e.imgurl&&"undefined"!=typeof e.imgurl?'<div class="imgcontainer" data-image-src="'+e.imgurl+'" ></div>':'<div class="imgcontainer imgloaded" style="background-image:url(http://www-mtl.mit.edu/wpmu/marc2016/files/2015/08/placeholder-camera-green.png)" ></div>',t+='<div class="eventtext">',t+='<div class="title">'+n+"</div>",t+='<div class="start_time">'+i+"</div>",t+='<div class="eventlocation-container">',t+='<div class="eventblackbar"></div>',t+='<div class="eventlocation">'+e.parentname+"</div></div></div></div>"}},EventSingleModule={settings:{},init:function(){var e=0;$(document).on("mouseup",".share",function(){(new Date).getTime()-e>1e3&&(window.open("https://www.facebook.com/sharer/sharer.php?u=https%3A//www.facebook.com/events/"+$(this).parent().attr("id")),e=(new Date).getTime())});var t=0;$(document).on("mouseup",".fb",function(){(new Date).getTime()-t>1e3&&(window.open("https://fb.com/"+$(this).attr("id")),t=(new Date).getTime())});var i=0;$(document).on("mouseup",".ticket",function(){(new Date).getTime()-i>1e3&&(window.open($(this).attr("data-ticket")),i=(new Date).getTime())})},bindUIActions:function(){},render_sv_event:function(e,t){for(var i,n=0;n<EventContentModule.settings.events.length;n++)if(EventContentModule.settings.events[n].id.toString()===e){i=EventContentModule.settings.events[n];break}console.log(i),ViewHandler.settings.right_container.html(this.generate_sv_event_html(i)),ViewHandler.settings.right_container.addClass("active"),ViewHandler.settings.left_container.addClass("active"),$(".event-sv-info-placeholder").css({height:$(".event-sv-info").outerHeight()+"px"}),setTimeout(function(){$(window).trigger("resize")},200)},generate_sv_event_html:function(e){var t=HelpFunctions.nl2p(HelpFunctions.linkifier(e.description)),i=HelpFunctions.formatDate(e.start_time,!0,!0),n='<div class="event-sv-content-container">';n+='<div class="event-singleview">',n+='<div class="event-sv-parentname">'+e.parentname+"</div>",n+=""!==e.imgurl&&null!==e.imgurl&&"undefined"!=typeof e.imgurl?'<div class="event-sv-img" style="background-image:url('+e.imgurl+');"></div>':'<div class="event-sv-img" style="background-image:url(http://www-mtl.mit.edu/wpmu/marc2016/files/2015/08/placeholder-camera-green.png);"></div>',n+='<div class="event-sv-title">'+e.name+"</div>",n+='<div class="event-sv-start-time">'+i+"</div>",n+='<hr class="lineBreak" />',n+='<div class="es-btns" id="'+e.fbid+'">',n+='<div class="status-btn share"><img src="'+template_uri+'/style/assets/icons/share.svg" class="icon share" />',n+='<div class="text">Del</div></div>',""!==e.ticket_uri&&null!==e.ticket_uri&&(n+='<div class="status-btn ticket" data-ticket="'+e.ticket_uri+'">',n+='<img src="'+template_uri+'/style/assets/icons/ticket.svg" class="icon ticket" />',n+='<div class="text">Køb billet</div></div>'),n+='</div><hr class="lineBreak" />',n+='<div class="event-sv-desc">'+t+"</div>",n+="</div>",n+='<div class="event-sv-info-placeholder"></div>',n+='<div class="event-sv-info">',n+='<div class="event-sv-parentname">'+e.parentname+"</div>";var s="";return null!==e.adress&&"undefined"!=typeof e.adress&&(s=e.adress),n+='<div class="event-sv-adress">'+s+"</div>",null!==e.website&&"undefined"!=typeof e.website&&(n+='<a class="event-sv-website" href="'+e.website+'">'+e.website+"</a>"),n+='<div class="fb" id="'+e.fbid+'"><img class="fbIcon" src="'+template_uri+'/style/assets/icons/facebook.svg" /></div>',n+="</div></div>",""!==commercial_image_url&&(n+='<div class="commercial-placeholder"></div>',n+='<a href="'+commercial_link+'"><div class="commercial-img" style="background-image:url('+commercial_image_url+');"></div></a>'),n}},FrontPageModule={settings:{ready:!1,lc:"",loadMoreGetNum:25},init:function(){var e='<div id="eventsbar">';e+='<div id="eventslayoutbtns">',e+='<img class="blocklayoutbtn" src="'+template_uri+'/style/assets/icons/blockLayout.PNG" />',e+='<img class="linelayoutbtn" src="'+template_uri+'/style/assets/icons/lineLayout.PNG" /></div>',e+='<div class="monthSelector"></div>',e+='</div><div class="picker"></div>',e+='<div class="eventscontainer"></div>',e+='<div class="load-more">Indlæs '+this.settings.loadMoreGetNum+" mere</div>",this.settings.lc=e,ViewHandler.settings.left_container.html(e),this.generate_front_page()},generate_front_page:function(){ViewHandler.closeSingleView(),ViewControllerModule.disableBackButton(),ViewHandler.settings.poly_view?ViewHandler.closeSingleView():(ViewHandler.settings.left_container.removeClass("active"),ViewHandler.settings.right_container.html("").removeClass("active")),ViewHandler.settings.left_container.html(this.settings.lc),$(".eventscontainer").removeClass("lineLayout"),this.bindUIActions(),EventCalenderModule.renderEventCalender(".eventscontainer",{getNum:0,acceptOld:!1}),$(".load-more").trigger("click"),ViewHandler.bindUIActions(),this.updateLayoutPosition(),ViewControllerModule.disableBackButton(),ViewHandler.settings.poly_view&&setTimeout(function(){ViewHandler.reload_view(!1),ViewHandler.go_to(0)},150),setTimeout(function(){$(window).trigger("resize")},250),this.settings.ready=!0},bindUIActions:function(){this.settings.ready||$(".logo-container").on("click",function(){this.generate_front_page(),$("#searchfield").val("")}.bind(this)),$(document).on("click",".event",function(){this.updateLayoutPosition()}.bind(this)),$(".load-more").on("click",function(){var e=EventCalenderModule.loadMore(this.settings.loadMoreGetNum);e>this.settings.loadMoreGetNum&&(e=this.settings.loadMoreGetNum),e>0?$(".load-more").html("Indlæs "+e+" mere"):$(".load-more").html("Alt indhold indlæst"),setTimeout(function(){$(window).trigger("scroll"),syncScroll.rescaleContainer()},150)}.bind(this)),$(".blocklayoutbtn").on("click",function(){$(".eventscontainer").removeClass("lineLayout"),ViewHandler.reload_view(!0)}),$(".linelayoutbtn").on("click",function(){$(".eventscontainer").addClass("lineLayout"),ViewHandler.reload_view(!0)}),$(".monthSelector").monthPicker({appendSelector:".picker"},function(e){$(".eventscontainer").html(""),EventCalenderModule.renderEventCalender(".eventscontainer",{getNum:0,acceptOld:!0,from:e[0].month_from,to:e[0].month_to});var t=EventCalenderModule.loadMore(25);t===-1&&$(".eventscontainer").html('<div class="error">Ingen elementer fundet</div>'),this.updateLayoutPosition(),setTimeout(function(){syncScroll.rescaleContainer(),$(window).trigger("resize")},100)}.bind(this))},updateLayoutPosition:function(){setTimeout(function(){if($(".event-sv-info").length>0)var e=$(".event-sv-info").outerHeight();else var e=141;$(".load-more").css({height:e+"px","line-height":e+"px"}),ViewHandler.settings.left_container.css({"padding-bottom":e+"px"}),syncScroll.rescaleContainer()},150)}},HeaderModule={settings:{menu_ready:!1,breakpoint:0,views:[]},init:function(){var e=$(".header-commercials").find(".swiper-slide").length;if(e>1)var t=new Swiper(".header-commercials",{direction:"horizontal",loop:!0,autoplay:4500,autoplayDisableOnInteraction:!1});this.bindUIActions()},bindUIActions:function(){this.settings.menu_ready=!1,$(window).on("scroll",function(){$(".header-container").removeClass("active"),$(".menu-show-btns").removeClass("active"),this.settings.breakpoint=$("#header").height()+$("#header").position().top,$(window).scrollTop()>=this.settings.breakpoint?($(".header-container").addClass("fixed"),$(".header-placeholder").addClass("fixed"),$(".menu-show-btns").addClass("show"),$(".event-singleview").addClass("fixed"),this.settings.menu_ready=!0):($(".header-container").removeClass("fixed"),$(".header-placeholder").removeClass("fixed"),$(".menu-show-btns").removeClass("show"),$(".event-singleview").removeClass("fixed"),this.settings.menu_ready=!1),$(window).innerWidth()<=640&&($(".header-container").addClass("fixed"),$(".header-placeholder").addClass("fixed"),$(".menu-show-btns").addClass("show"),$(".event-singleview").addClass("fixed"),this.settings.menu_ready=!0)}.bind(this)),$(window).trigger("scroll"),$(window).on("resize",function(){$(this).trigger("scroll")}),$(".menu-show-btns").on("click",this.show_menu.bind(this)),$(window).on("keydown",function(e){$(window).scrollTop()>$("#header").height()&&!$(".header-container").hasClass("active")&&32===e.keyCode?(e.preventDefault(),$("#searchfield").focus(),this.show_menu()):$(window).scrollTop()>$("#header").height()&&$(".header-container").hasClass("active")&&32===e.keyCode&&(""!==$("#searchfield").val()&&" "!==$("#searchfield").val()||(e.preventDefault(),$("#searchfield").val(""),this.show_menu()))}.bind(this))},show_menu:function(){this.settings.menu_ready&&($(".menu-show-btns").hasClass("active")?($(".menu-show-btns").removeClass("active"),$(".header-container").removeClass("active")):($(".menu-show-btns").addClass("active"),$(".header-container").addClass("active")))}},MobileLayoutModule={settings:{ready:!1,bbActive:!1,backButton:$(".back-button"),betaWarning:$(".beta-warning"),socialMedia:$(".socialmedia")},init:function(){this.bindUIActions(),this.settings.ready=!0},bindUIActions:function(){$(document).on("click",".event",function(){this.activeBackButton()}.bind(this)),this.settings.backButton.on("click",function(){ViewHandler.go_to(0),this.disableBackButton()}.bind(this))},activeBackButton:function(){this.settings.bbActive||(setTimeout(function(){this.settings.backButton.addClass("active")}.bind(this),300),this.settings.betaWarning.removeClass("active"),this.settings.socialMedia.removeClass("active"),this.settings.bbActive=!0)},disableBackButton:function(){this.settings.bbActive&&(this.settings.backButton.removeClass("active"),setTimeout(function(){this.settings.betaWarning.addClass("active"),this.settings.socialMedia.addClass("active")}.bind(this),300),this.settings.bbActive=!1)}},ViewControllerModule={settings:{ready:!1,bbActive:!1,backButton:$(".back-button"),betaWarning:$(".beta-warning"),socialMedia:$(".socialmedia"),mobile:!1},init:function(){this.update(),this.bindUIActions(),this.settings.ready=!0},update:function(){$(window).innerWidth()<=640?(this.settings.mobile=!0,this.settings.backButton.addClass("mobile")):(this.settings.mobile=!1,this.settings.backButton.removeClass("mobile"))},bindUIActions:function(){$(document).on("click",".event",function(){this.activeBackButton()}.bind(this)),$(window).on("resize",this.update.bind(this)),this.settings.backButton.on("click",function(){this.settings.mobile&&ViewHandler.go_to(0),this.disableBackButton(),ViewHandler.closeSingleView()}.bind(this))},activeBackButton:function(){this.settings.bbActive||(setTimeout(function(){this.settings.backButton.addClass("active")}.bind(this),300),this.settings.betaWarning.removeClass("active"),this.settings.socialMedia.removeClass("active"),this.settings.bbActive=!0)},disableBackButton:function(){this.settings.bbActive&&(this.settings.backButton.removeClass("active"),setTimeout(function(){this.settings.betaWarning.addClass("active"),this.settings.socialMedia.addClass("active")}.bind(this),300),this.settings.bbActive=!1)}},ImageController={settings:{backImages:!0,loaderReady:!1,state:-1,large_ready:!1,medium_ready:!1,small_ready:!1,size_large:1400,size_medium:950,size_small:500},init:function(){var e=new XMLHttpRequest;e.onload=function(){ImageController.settings.loaderReady=!0},e.open("GET",template_uri+"/style/assets/icons/loading.gif"),e.send(),this.headerImgControl(),$(".slide-img").each(function(e,t){var i=new XMLHttpRequest;i.open("GET",$(this).attr("data-src-large")),i.send(),i=new XMLHttpRequest,i.open("GET",$(this).attr("data-src-medium")),i.send(),i=new XMLHttpRequest,i.open("GET",$(this).attr("data-src-small")),i.send()}),$(window).trigger("scroll"),this.bindUIActions()},bindUIActions:function(){$(window).on("resize",function(){this.headerImgControl()}.bind(this)),$(window).on("scroll",function(){$("[data-image-src]").each(function(e,t){var i=$(this).offset().top-$(this).outerHeight(),n=$(this).offset().top;if(i>$(window).scrollTop()&&n<$(window).scrollTop()+$(window).innerHeight()&&"undefined"!=typeof $(this).attr("data-image-src")&&!$(this).hasClass("imgloaded")){$(this).addClass("imgloaded"),ImageController.settings.loaderReady&&(ImageController.settings.backImages?$(this).css("background-image","url("+template_uri+"/style/assets/icons/loading.gif)").addClass("loading"):$(this).attr("src",template_uri+"/style/assets/icons/loading.gif").addClass("loading"));var s=new XMLHttpRequest;s.onload=function(){ImageController.settings.backImages?$(this).css("background-image","url("+$(this).attr("data-image-src")+")"):$(this).attr("src",$(this).attr("data-src")),$(this).removeAttr("data-image-src").removeClass("loading")}.bind(this),s.open("GET",$(this).attr("data-image-src")),s.send()}})})},headerImgControl:function(){var e=this.settings,t=e.size_medium+(e.size_large-e.size_medium)/2,i=e.size_small+(e.size_medium-e.size_small)/2;$(".slide-img").each(function(n,s){$(window).innerWidth()>t?0!==e.state&&($(this).attr("src",$(this).attr("data-src-large")),e.state=0):$(window).innerWidth()>i?1!==e.state&&($(this).attr("src",$(this).attr("data-src-medium")),e.state=1):2!==e.state&&($(this).attr("src",$(this).attr("data-src-small")),e.state=2)})}};$(function(){$("a").click(function(e){"#"===$(this).attr("href")&&e.preventDefault()}),$(window).on("click",function(){$(window).trigger("resize"),setTimeout(function(){syncScroll.rescaleContainer()},200)}),HeaderModule.init(),ImageController.init(),ViewHandler.init(),ViewControllerModule.init(),EventCalenderModule.init(),EventContentModule.init(function(){e()});var e=function(){FrontPageModule.init(),SearchModule.init(),EventSingleModule.init(),syncScroll.init($("#page-content"),".container-section"),setTimeout(function(){syncScroll.rescaleContainer()},150)}});